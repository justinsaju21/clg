{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <div class="grid grid-cols-12 gap-6">

        <!-- Left Column: User & Learning Status (3 cols) -->
        <div class="col-span-12 lg:col-span-3 space-y-6">
            <!-- User Profile Card -->
            <div class="bg-white rounded-lg shadow-sm p-6 text-center border border-gray-100">
                <div
                    class="w-24 h-24 mx-auto bg-tron-teal rounded-full flex items-center justify-center text-white text-3xl font-bold mb-4 overflow-hidden">
                    {% if student.avatar %}
                    <img src="{{ student.avatar.url }}" class="w-full h-full object-cover">
                    {% else %}
                    {{ student.username|make_list|first|upper }}
                    {% endif %}
                </div>
                <h2 class="text-lg font-bold text-gray-800">{{ student.first_name }} {{ student.last_name }}</h2>
                <p class="text-sm text-gray-500">{{ student.get_role_display }}</p>
                <div class="mt-4 flex justify-between text-xs text-gray-500 px-4">
                    <div class="text-center">
                        <span class="block font-bold text-gray-800">12</span>
                        Courses
                    </div>
                    <div class="text-center">
                        <span class="block font-bold text-gray-800">85%</span>
                        Avg Grade
                    </div>
                </div>
            </div>

            <!-- Radar Chart Widget -->
            <div class="bg-white rounded-lg shadow-sm p-4 border border-gray-100">
                <h3 class="text-sm font-bold text-gray-700 mb-4 border-l-4 border-tron-teal pl-2">My Learning Status
                </h3>
                <canvas id="learningRadar"></canvas>
            </div>
        </div>

        <!-- Center Column: My Courses (6 cols) -->
        <div class="col-span-12 lg:col-span-6 space-y-6">
            <!-- Tabs -->
            <div class="flex space-x-6 border-b border-gray-200 pb-2">
                <button class="text-tron-teal font-bold border-b-2 border-tron-teal pb-2">My Studying</button>
                <button class="text-gray-500 hover:text-gray-700 pb-2">My Favorites</button>
                <button class="text-gray-500 hover:text-gray-700 pb-2">Archive</button>
            </div>

            <!-- Course Cards -->
            {% for course in courses %}
            <div
                class="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100 flex hover:shadow-md transition-shadow">
                <div class="w-1/3 bg-gray-200">
                    <!-- Placeholder Cover -->
                    <div class="h-full bg-cover bg-center"
                        style="background-image: url('https://placehold.co/400x300?text={{ course.course_code }}');">
                    </div>
                </div>
                <div class="w-2/3 p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-gray-800 text-lg">{{ course.name }}</h3>
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">{{ course.course_code
                            }}</span>
                    </div>
                    <p class="text-sm text-gray-500 mb-4">Instructor: {{ course.instructor.username }}</p>

                    <!-- Progress Bar -->
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="flex-1 h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-tron-teal" style="width: 45%"></div>
                        </div>
                        <span class="text-xs text-tron-teal font-bold">45%</span>
                    </div>

                    <div class="flex justify-end">
                        <button
                            class="text-xs bg-tron-teal text-white px-3 py-1.5 rounded hover:bg-tron-teal-dark">Enter
                            Course</button>
                    </div>
                </div>
            </div>
            {% empty %}
            <!-- Mock for visual if no courses -->
            <div class="bg-white rounded-lg p-6 text-center text-gray-400">
                No courses found. Join a course to get started.
            </div>
            {% endfor %}
        </div>

        <!-- Right Column: To-Do & Announcements (3 cols) -->
        <div class="col-span-12 lg:col-span-3 space-y-6">
            <!-- To-Do List -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center">
                    <h3 class="font-bold text-gray-700 text-sm"><i class="far fa-calendar-check mr-2"></i> To-Do List
                    </h3>
                    <span class="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">2</span>
                </div>
                <div class="divide-y divide-gray-50">
                    {% for todo in todo_list %}
                    <div
                        class="p-4 hover:bg-gray-50 cursor-pointer border-l-4 {% if todo.status == 'urgent' %}border-red-500{% else %}border-blue-500{% endif %}">
                        <p class="text-sm font-medium text-gray-800">{{ todo.title }}</p>
                        <p class="text-xs text-gray-500 mt-1">Due: {{ todo.due }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Announcements -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-4">
                <h3 class="font-bold text-gray-700 text-sm mb-4"><i class="fas fa-bullhorn mr-2"></i> Announcements</h3>
                <div class="space-y-4">
                    {% for item in announcements %}
                    <div>
                        <a href="#" class="text-sm text-tron-teal font-medium hover:underline">{{ item.title }}</a>
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>{{ item.author }}</span>
                            <span>{{ item.date }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize Radar Chart
    const ctx = document.getElementById('learningRadar').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Video', 'Quiz', 'Discussion', 'Assignment', 'Attendance'],
            datasets: [{
                label: 'Performance',
                data: [{{ radar_data| join: ", " }}],
        fill: true,
        backgroundColor: 'rgba(23, 162, 184, 0.2)', // Tron Teal transparent
        borderColor: 'rgb(23, 162, 184)',
        pointBackgroundColor: 'rgb(23, 162, 184)',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: 'rgb(23, 162, 184)'
    }]
        },
    options: {
        elements: { line: { tension: 0.3 } },
        scales: { r: { suggestedMin: 0, suggestedMax: 100 } },
        plugins: { legend: { display: false } }
    }
    });
</script>
{% endblock %}